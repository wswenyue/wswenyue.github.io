import{_ as o}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as t,f as c,a as n,b as p,d as e,r as l,o as r}from"./app-myKONBUc.js";const k={},u={href:"https://developer.android.com/ndk/guides/ndk-stack",target:"_blank",rel:"noopener noreferrer"},i={href:"https://www.kancloud.cn/xyang0917/blogjnindk/117018",target:"_blank",rel:"noopener noreferrer"};function m(b,s){const a=l("ExternalLinkIcon");return r(),t("div",null,[s[2]||(s[2]=c(`<h1 id="ndk-开发相关" tabindex="-1"><a class="header-anchor" href="#ndk-开发相关"><span>NDK 开发相关</span></a></h1><h3 id="javah使用-native接口头文件生成" tabindex="-1"><a class="header-anchor" href="#javah使用-native接口头文件生成"><span>javah使用---native接口头文件生成</span></a></h3><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># 编译之后，进入到对应class顶层包中,执行javah，会在当前目录下生成对应的头文件。</span>
$ javah com.xx.thelight.TheLight
<span class="token comment"># 如需依赖Android相关环境</span>
$ javah <span class="token parameter variable">-classpath</span> <span class="token variable">$ANDROID_PLATFORMS</span>/android-22/android.jar:. com.xx.thelight.TheLight
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="javap使用-方法签名获取" tabindex="-1"><a class="header-anchor" href="#javap使用-方法签名获取"><span>javap使用---方法签名获取</span></a></h3><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># 编译之后，进入对应的class目录，执行。</span>
$ javap <span class="token parameter variable">-s</span> TheLight
<span class="token comment"># eg:</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>xx<span class="token punctuation">.</span>thelight<span class="token punctuation">.</span></span>TheLight</span> <span class="token punctuation">{</span>
 	<span class="token keyword">public</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>xx<span class="token punctuation">.</span>thelight<span class="token punctuation">.</span></span>TheLight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   	descriptor<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name">V</span>

 	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">native</span> <span class="token keyword">int</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   	descriptor<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token constant">II</span><span class="token punctuation">)</span><span class="token class-name">I</span>

 	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">native</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>String</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>String</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   	descriptor<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></blockquote><h3 id="使用addr2line定位出错位置" tabindex="-1"><a class="header-anchor" href="#使用addr2line定位出错位置"><span>使用addr2line定位出错位置</span></a></h3><p>工具位置ndk下<code>/toolchains/arm-linux-androideabi-4.9/prebuilt/darwin-x86_64/bin/</code>中的<code>arm-linux-androideabi-addr2line</code></p><p>使用方式：</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>$ addr2line <span class="token parameter variable">-e</span> so_path 汇编地址<span class="token punctuation">..</span>.

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>eg: 例如分析下面一个错误信息日志</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">17</span><span class="token operator">:</span><span class="token number">59</span><span class="token operator">:</span><span class="token number">38.246</span><span class="token operator">:</span> <span class="token class-name">D</span><span class="token operator">/</span><span class="token function">dalvikvm</span><span class="token punctuation">(</span><span class="token number">20794</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token class-name">Late</span><span class="token operator">-</span>enabling <span class="token class-name">CheckJNI</span>
<span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">17</span><span class="token operator">:</span><span class="token number">59</span><span class="token operator">:</span><span class="token number">38.246</span><span class="token operator">:</span> <span class="token class-name">I</span><span class="token operator">/</span><span class="token class-name">ActivityManager</span><span class="token punctuation">(</span><span class="token number">1185</span><span class="token punctuation">)</span><span class="token operator">:</span> 
<span class="token class-name">Start</span> proc com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>hellojni <span class="token keyword">for</span> activity com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>hellojni<span class="token operator">/</span><span class="token punctuation">.</span>HelloJni<span class="token operator">:</span> pid<span class="token operator">=</span><span class="token number">20794</span> uid<span class="token operator">=</span><span class="token number">10351</span> gids<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">50351</span><span class="token punctuation">,</span> <span class="token number">1028</span><span class="token punctuation">,</span> <span class="token number">1015</span><span class="token punctuation">}</span>
<span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">17</span><span class="token operator">:</span><span class="token number">59</span><span class="token operator">:</span><span class="token number">38.296</span><span class="token operator">:</span> <span class="token class-name">I</span><span class="token operator">/</span><span class="token function">dalvikvm</span><span class="token punctuation">(</span><span class="token number">20794</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token class-name">Enabling</span> <span class="token constant">JNI</span> app bug workarounds <span class="token keyword">for</span> target <span class="token constant">SDK</span> version <span class="token number">3.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">17</span><span class="token operator">:</span><span class="token number">59</span><span class="token operator">:</span><span class="token number">38.366</span><span class="token operator">:</span> <span class="token class-name">D</span><span class="token operator">/</span><span class="token function">dalvikvm</span><span class="token punctuation">(</span><span class="token number">20794</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token class-name">Trying</span> <span class="token keyword">to</span> <span class="token namespace">load</span> lib <span class="token operator">/</span>data<span class="token operator">/</span>app<span class="token operator">-</span>lib<span class="token operator">/</span>com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>hellojni<span class="token operator">-</span><span class="token number">1</span><span class="token operator">/</span>libhello<span class="token operator">-</span>jni<span class="token punctuation">.</span>so <span class="token number">0x422a4f58</span>
<span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">17</span><span class="token operator">:</span><span class="token number">59</span><span class="token operator">:</span><span class="token number">38.366</span><span class="token operator">:</span> <span class="token class-name">D</span><span class="token operator">/</span><span class="token function">dalvikvm</span><span class="token punctuation">(</span><span class="token number">20794</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token class-name">Added</span> shared lib <span class="token operator">/</span>data<span class="token operator">/</span>app<span class="token operator">-</span>lib<span class="token operator">/</span>com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>hellojni<span class="token operator">-</span><span class="token number">1</span><span class="token operator">/</span>libhello<span class="token operator">-</span>jni<span class="token punctuation">.</span>so <span class="token number">0x422a4f58</span>
<span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">17</span><span class="token operator">:</span><span class="token number">59</span><span class="token operator">:</span><span class="token number">38.366</span><span class="token operator">:</span> <span class="token class-name">A</span><span class="token operator">/</span><span class="token function">libc</span><span class="token punctuation">(</span><span class="token number">20794</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token class-name">Fatal</span> signal <span class="token number">8</span> <span class="token punctuation">(</span><span class="token constant">SIGFPE</span><span class="token punctuation">)</span> at <span class="token number">0x0000513a</span> <span class="token punctuation">(</span>code<span class="token operator">=</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span> thread <span class="token number">20794</span> <span class="token punctuation">(</span>xample<span class="token punctuation">.</span>hellojni<span class="token punctuation">)</span>
<span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">17</span><span class="token operator">:</span><span class="token number">59</span><span class="token operator">:</span><span class="token number">38.476</span><span class="token operator">:</span> <span class="token class-name">I</span><span class="token operator">/</span><span class="token function">DEBUG</span><span class="token punctuation">(</span><span class="token number">253</span><span class="token punctuation">)</span><span class="token operator">:</span> pid<span class="token operator">:</span> <span class="token number">20794</span><span class="token punctuation">,</span> tid<span class="token operator">:</span> <span class="token number">20794</span><span class="token punctuation">,</span> name<span class="token operator">:</span> xample<span class="token punctuation">.</span>hellojni  <span class="token operator">&gt;&gt;&gt;</span> com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>hellojni <span class="token operator">&lt;&lt;</span><span class="token operator">&lt;</span>
<span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">17</span><span class="token operator">:</span><span class="token number">59</span><span class="token operator">:</span><span class="token number">38.476</span><span class="token operator">:</span> <span class="token class-name">I</span><span class="token operator">/</span><span class="token function">DEBUG</span><span class="token punctuation">(</span><span class="token number">253</span><span class="token punctuation">)</span><span class="token operator">:</span> signal <span class="token number">8</span> <span class="token punctuation">(</span><span class="token constant">SIGFPE</span><span class="token punctuation">)</span><span class="token punctuation">,</span> code <span class="token operator">-</span><span class="token number">6</span> <span class="token punctuation">(</span><span class="token constant">SI_TKILL</span><span class="token punctuation">)</span><span class="token punctuation">,</span> fault addr <span class="token number">0000513</span>a
<span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">17</span><span class="token operator">:</span><span class="token number">59</span><span class="token operator">:</span><span class="token number">38.586</span><span class="token operator">:</span> <span class="token class-name">I</span><span class="token operator">/</span><span class="token function">DEBUG</span><span class="token punctuation">(</span><span class="token number">253</span><span class="token punctuation">)</span><span class="token operator">:</span>     r0 <span class="token number">00000000</span>  r1 <span class="token number">0000513</span>a  r2 <span class="token number">00000008</span>  r3 <span class="token number">00000000</span>
<span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">17</span><span class="token operator">:</span><span class="token number">59</span><span class="token operator">:</span><span class="token number">38.586</span><span class="token operator">:</span> <span class="token class-name">I</span><span class="token operator">/</span><span class="token function">DEBUG</span><span class="token punctuation">(</span><span class="token number">253</span><span class="token punctuation">)</span><span class="token operator">:</span>     r4 <span class="token number">00000008</span>  r5 <span class="token number">0000000d</span>  r6 <span class="token number">0000513</span>a  r7 <span class="token number">0000010</span>c
<span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">17</span><span class="token operator">:</span><span class="token number">59</span><span class="token operator">:</span><span class="token number">38.586</span><span class="token operator">:</span> <span class="token class-name">I</span><span class="token operator">/</span><span class="token function">DEBUG</span><span class="token punctuation">(</span><span class="token number">253</span><span class="token punctuation">)</span><span class="token operator">:</span>     r8 <span class="token number">75226d</span><span class="token number">08</span>  r9 <span class="token number">00000000</span>  sl <span class="token number">417</span>c5c38  fp bedbf134
<span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">17</span><span class="token operator">:</span><span class="token number">59</span><span class="token operator">:</span><span class="token number">38.586</span><span class="token operator">:</span> <span class="token class-name">I</span><span class="token operator">/</span><span class="token function">DEBUG</span><span class="token punctuation">(</span><span class="token number">253</span><span class="token punctuation">)</span><span class="token operator">:</span>     ip <span class="token number">41705910</span>  sp bedbf0f0  lr <span class="token number">4012e169</span>  pc <span class="token number">4013d</span><span class="token number">10</span>c  cpsr <span class="token number">000f</span><span class="token number">0010</span>
											<span class="token comment">// 省略部份日志 。。。。。。</span>
<span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">17</span><span class="token operator">:</span><span class="token number">59</span><span class="token operator">:</span><span class="token number">38.596</span><span class="token operator">:</span> <span class="token class-name">I</span><span class="token operator">/</span><span class="token function">DEBUG</span><span class="token punctuation">(</span><span class="token number">253</span><span class="token punctuation">)</span><span class="token operator">:</span> backtrace<span class="token operator">:</span>
<span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">17</span><span class="token operator">:</span><span class="token number">59</span><span class="token operator">:</span><span class="token number">38.596</span><span class="token operator">:</span> <span class="token class-name">I</span><span class="token operator">/</span><span class="token function">DEBUG</span><span class="token punctuation">(</span><span class="token number">253</span><span class="token punctuation">)</span><span class="token operator">:</span>     #<span class="token number">00</span>  pc <span class="token number">0002210</span>c  <span class="token operator">/</span>system<span class="token operator">/</span>lib<span class="token operator">/</span>libc<span class="token punctuation">.</span>so <span class="token punctuation">(</span>tgkill<span class="token operator">+</span><span class="token number">12</span><span class="token punctuation">)</span>
<span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">17</span><span class="token operator">:</span><span class="token number">59</span><span class="token operator">:</span><span class="token number">38.596</span><span class="token operator">:</span> <span class="token class-name">I</span><span class="token operator">/</span><span class="token function">DEBUG</span><span class="token punctuation">(</span><span class="token number">253</span><span class="token punctuation">)</span><span class="token operator">:</span>     #<span class="token number">01</span>  pc <span class="token number">00013165</span>  <span class="token operator">/</span>system<span class="token operator">/</span>lib<span class="token operator">/</span>libc<span class="token punctuation">.</span>so <span class="token punctuation">(</span>pthread_kill<span class="token operator">+</span><span class="token number">48</span><span class="token punctuation">)</span>
<span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">17</span><span class="token operator">:</span><span class="token number">59</span><span class="token operator">:</span><span class="token number">38.596</span><span class="token operator">:</span> <span class="token class-name">I</span><span class="token operator">/</span><span class="token function">DEBUG</span><span class="token punctuation">(</span><span class="token number">253</span><span class="token punctuation">)</span><span class="token operator">:</span>     #<span class="token number">02</span>  pc <span class="token number">00013379</span>  <span class="token operator">/</span>system<span class="token operator">/</span>lib<span class="token operator">/</span>libc<span class="token punctuation">.</span>so <span class="token punctuation">(</span>raise<span class="token operator">+</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">17</span><span class="token operator">:</span><span class="token number">59</span><span class="token operator">:</span><span class="token number">38.596</span><span class="token operator">:</span> <span class="token class-name">I</span><span class="token operator">/</span><span class="token function">DEBUG</span><span class="token punctuation">(</span><span class="token number">253</span><span class="token punctuation">)</span><span class="token operator">:</span>     #<span class="token number">03</span>  pc <span class="token number">00000e80</span>  <span class="token operator">/</span>data<span class="token operator">/</span>app<span class="token operator">-</span>lib<span class="token operator">/</span>com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>hellojni<span class="token operator">-</span><span class="token number">1</span><span class="token operator">/</span>libhello<span class="token operator">-</span>jni<span class="token punctuation">.</span>so <span class="token punctuation">(</span>__aeabi_idiv0<span class="token operator">+</span><span class="token number">8</span><span class="token punctuation">)</span>
<span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">17</span><span class="token operator">:</span><span class="token number">59</span><span class="token operator">:</span><span class="token number">38.596</span><span class="token operator">:</span> <span class="token class-name">I</span><span class="token operator">/</span><span class="token function">DEBUG</span><span class="token punctuation">(</span><span class="token number">253</span><span class="token punctuation">)</span><span class="token operator">:</span>     #<span class="token number">04</span>  pc <span class="token number">00000</span>cf4  <span class="token operator">/</span>data<span class="token operator">/</span>app<span class="token operator">-</span>lib<span class="token operator">/</span>com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>hellojni<span class="token operator">-</span><span class="token number">1</span><span class="token operator">/</span>libhello<span class="token operator">-</span>jni<span class="token punctuation">.</span>so <span class="token punctuation">(</span>willCrash<span class="token operator">+</span><span class="token number">32</span><span class="token punctuation">)</span>
<span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">17</span><span class="token operator">:</span><span class="token number">59</span><span class="token operator">:</span><span class="token number">38.596</span><span class="token operator">:</span> <span class="token class-name">I</span><span class="token operator">/</span><span class="token function">DEBUG</span><span class="token punctuation">(</span><span class="token number">253</span><span class="token punctuation">)</span><span class="token operator">:</span>     #<span class="token number">05</span>  pc <span class="token number">00000d</span><span class="token number">1</span>c  <span class="token operator">/</span>data<span class="token operator">/</span>app<span class="token operator">-</span>lib<span class="token operator">/</span>com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>hellojni<span class="token operator">-</span><span class="token number">1</span><span class="token operator">/</span>libhello<span class="token operator">-</span>jni<span class="token punctuation">.</span>so <span class="token punctuation">(</span><span class="token class-name">JNI_OnLoad</span><span class="token operator">+</span><span class="token number">20</span><span class="token punctuation">)</span>
<span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">17</span><span class="token operator">:</span><span class="token number">59</span><span class="token operator">:</span><span class="token number">38.596</span><span class="token operator">:</span> <span class="token class-name">I</span><span class="token operator">/</span><span class="token function">DEBUG</span><span class="token punctuation">(</span><span class="token number">253</span><span class="token punctuation">)</span><span class="token operator">:</span>     #<span class="token number">06</span>  pc <span class="token number">00052</span>eb1  <span class="token operator">/</span>system<span class="token operator">/</span>lib<span class="token operator">/</span>libdvm<span class="token punctuation">.</span>so <span class="token punctuation">(</span><span class="token function">dvmLoadNativeCode</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token keyword">const</span><span class="token operator">*</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token operator">*</span><span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">468</span><span class="token punctuation">)</span>
<span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">17</span><span class="token operator">:</span><span class="token number">59</span><span class="token operator">:</span><span class="token number">38.596</span><span class="token operator">:</span> <span class="token class-name">I</span><span class="token operator">/</span><span class="token function">DEBUG</span><span class="token punctuation">(</span><span class="token number">253</span><span class="token punctuation">)</span><span class="token operator">:</span>     #<span class="token number">07</span>  pc <span class="token number">0006</span>a62d  <span class="token operator">/</span>system<span class="token operator">/</span>lib<span class="token operator">/</span>libdvm<span class="token punctuation">.</span>so
<span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">17</span><span class="token operator">:</span><span class="token number">59</span><span class="token operator">:</span><span class="token number">38.596</span><span class="token operator">:</span> <span class="token class-name">I</span><span class="token operator">/</span><span class="token function">DEBUG</span><span class="token punctuation">(</span><span class="token number">253</span><span class="token punctuation">)</span><span class="token operator">:</span>     	   <span class="token comment">// 省略部份日志 。。。。。。</span>
<span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">17</span><span class="token operator">:</span><span class="token number">59</span><span class="token operator">:</span><span class="token number">38.596</span><span class="token operator">:</span> <span class="token class-name">I</span><span class="token operator">/</span><span class="token function">DEBUG</span><span class="token punctuation">(</span><span class="token number">253</span><span class="token punctuation">)</span><span class="token operator">:</span> stack<span class="token operator">:</span>
<span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">17</span><span class="token operator">:</span><span class="token number">59</span><span class="token operator">:</span><span class="token number">38.596</span><span class="token operator">:</span> <span class="token class-name">I</span><span class="token operator">/</span><span class="token function">DEBUG</span><span class="token punctuation">(</span><span class="token number">253</span><span class="token punctuation">)</span><span class="token operator">:</span>          bedbf0b0  <span class="token number">71</span>b17034  <span class="token operator">/</span>system<span class="token operator">/</span>lib<span class="token operator">/</span>libsechook<span class="token punctuation">.</span>so
<span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">17</span><span class="token operator">:</span><span class="token number">59</span><span class="token operator">:</span><span class="token number">38.596</span><span class="token operator">:</span> <span class="token class-name">I</span><span class="token operator">/</span><span class="token function">DEBUG</span><span class="token punctuation">(</span><span class="token number">253</span><span class="token punctuation">)</span><span class="token operator">:</span>          bedbf0b4  <span class="token number">7521</span>ce28  
<span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">17</span><span class="token operator">:</span><span class="token number">59</span><span class="token operator">:</span><span class="token number">38.596</span><span class="token operator">:</span> <span class="token class-name">I</span><span class="token operator">/</span><span class="token function">DEBUG</span><span class="token punctuation">(</span><span class="token number">253</span><span class="token punctuation">)</span><span class="token operator">:</span>          bedbf0b8  <span class="token number">71</span>b17030  <span class="token operator">/</span>system<span class="token operator">/</span>lib<span class="token operator">/</span>libsechook<span class="token punctuation">.</span>so
<span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">17</span><span class="token operator">:</span><span class="token number">59</span><span class="token operator">:</span><span class="token number">38.596</span><span class="token operator">:</span> <span class="token class-name">I</span><span class="token operator">/</span><span class="token function">DEBUG</span><span class="token punctuation">(</span><span class="token number">253</span><span class="token punctuation">)</span><span class="token operator">:</span>          bedbf0bc  <span class="token number">4012</span>c3cf  <span class="token operator">/</span>system<span class="token operator">/</span>lib<span class="token operator">/</span>libc<span class="token punctuation">.</span>so <span class="token punctuation">(</span>dlfree<span class="token operator">+</span><span class="token number">50</span><span class="token punctuation">)</span>
<span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">17</span><span class="token operator">:</span><span class="token number">59</span><span class="token operator">:</span><span class="token number">38.596</span><span class="token operator">:</span> <span class="token class-name">I</span><span class="token operator">/</span><span class="token function">DEBUG</span><span class="token punctuation">(</span><span class="token number">253</span><span class="token punctuation">)</span><span class="token operator">:</span>          bedbf0c0  <span class="token number">40165000</span>  <span class="token operator">/</span>system<span class="token operator">/</span>lib<span class="token operator">/</span>libc<span class="token punctuation">.</span>so
<span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">17</span><span class="token operator">:</span><span class="token number">59</span><span class="token operator">:</span><span class="token number">38.596</span><span class="token operator">:</span> <span class="token class-name">I</span><span class="token operator">/</span><span class="token function">DEBUG</span><span class="token punctuation">(</span><span class="token number">253</span><span class="token punctuation">)</span><span class="token operator">:</span>          <span class="token comment">// 省略部份日志 。。。。。。</span>
<span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">17</span><span class="token operator">:</span><span class="token number">59</span><span class="token operator">:</span><span class="token number">38.736</span><span class="token operator">:</span> <span class="token class-name">W</span><span class="token operator">/</span><span class="token class-name">ActivityManager</span><span class="token punctuation">(</span><span class="token number">1185</span><span class="token punctuation">)</span><span class="token operator">:</span>   <span class="token class-name">Force</span> finishing activity com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>hellojni<span class="token operator">/</span><span class="token punctuation">.</span>HelloJni
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>backtrace日志可以看作是JNI调用的堆栈信息，以“#两位数字 pc”开头的都是backtrace日志。注意看第20行和21行，是我们自己编译的so文件和定义的两个函数，在这里引发了异常，导致程序崩溃。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">17</span><span class="token operator">:</span><span class="token number">59</span><span class="token operator">:</span><span class="token number">38.596</span><span class="token operator">:</span> <span class="token class-name">I</span><span class="token operator">/</span><span class="token function">DEBUG</span><span class="token punctuation">(</span><span class="token number">253</span><span class="token punctuation">)</span><span class="token operator">:</span>     #<span class="token number">04</span>  pc <span class="token number">00000</span>cf4  <span class="token operator">/</span>data<span class="token operator">/</span>app<span class="token operator">-</span>lib<span class="token operator">/</span>com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>hellojni<span class="token operator">-</span><span class="token number">1</span><span class="token operator">/</span>libhello<span class="token operator">-</span>jni<span class="token punctuation">.</span>so <span class="token punctuation">(</span>willCrash<span class="token operator">+</span><span class="token number">32</span><span class="token punctuation">)</span>
<span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">17</span><span class="token operator">:</span><span class="token number">59</span><span class="token operator">:</span><span class="token number">38.596</span><span class="token operator">:</span> <span class="token class-name">I</span><span class="token operator">/</span><span class="token function">DEBUG</span><span class="token punctuation">(</span><span class="token number">253</span><span class="token punctuation">)</span><span class="token operator">:</span>     #<span class="token number">05</span>  pc <span class="token number">00000d</span><span class="token number">1</span>c  <span class="token operator">/</span>data<span class="token operator">/</span>app<span class="token operator">-</span>lib<span class="token operator">/</span>com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>hellojni<span class="token operator">-</span><span class="token number">1</span><span class="token operator">/</span>libhello<span class="token operator">-</span>jni<span class="token punctuation">.</span>so <span class="token punctuation">(</span><span class="token class-name">JNI_OnLoad</span><span class="token operator">+</span><span class="token number">20</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>使用：</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>$ arm-linux-androideabi-addr2line <span class="token parameter variable">-e</span> libhello-jni.so 00000cf4 00000d1c
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="使用objdump-显示汇编指令内容。也可通过汇编地址定位相关函数" tabindex="-1"><a class="header-anchor" href="#使用objdump-显示汇编指令内容。也可通过汇编地址定位相关函数"><span>使用objdump 显示汇编指令内容。也可通过汇编地址定位相关函数</span></a></h3><p>工具位置ndk下<code>/toolchains/arm-linux-androideabi-4.9/prebuilt/darwin-x86_64/bin/</code>中的<code>arm-linux-androideabi-objdump</code></p><p>使用方法：</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment">#打印so的汇编内容</span>
<span class="token comment">#搜索相关汇编指令位置即可搜索到对应的函数，例如上面的cf4或d1c等</span>
$ objdump <span class="token parameter variable">-S</span> <span class="token parameter variable">-D</span> so_path
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="使用ndk-stack-打印具体信息" tabindex="-1"><a class="header-anchor" href="#使用ndk-stack-打印具体信息"><span>使用ndk-stack 打印具体信息</span></a></h3><p>使用方式</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># 通过logcat直接输出</span>
<span class="token comment"># so_path :是包含so的文件夹,例如$PROJECT_PATH/obj/local/armeabi </span>
$ adb logcat <span class="token operator">|</span> ndk-stack <span class="token parameter variable">-sym</span> so_path
<span class="token comment"># 如果有log可以直接这样使用</span>
$ ndk-stack <span class="token parameter variable">-sym</span> so_path <span class="token parameter variable">-dump</span> crash.log
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="参考文章" tabindex="-1"><a class="header-anchor" href="#参考文章"><span>参考文章</span></a></h1>`,24)),n("p",null,[n("a",u,[s[0]||(s[0]=p("Android ndk-stack 使用")),e(a)]),n("a",i,[s[1]||(s[1]=p("Android NDK开发Crash错误定位")),e(a)])])])}const h=o(k,[["render",m],["__file","ndk.html.vue"]]),g=JSON.parse('{"path":"/note/ndk.html","title":"NDK 开发相关","lang":"zh-CN","frontmatter":{"description":"NDK 开发相关 javah使用---native接口头文件生成 javap使用---方法签名获取 使用addr2line定位出错位置 工具位置ndk下/toolchains/arm-linux-androideabi-4.9/prebuilt/darwin-x86_64/bin/中的arm-linux-androideabi-addr2line 使用...","head":[["meta",{"property":"og:url","content":"https://wswenyue.vip/note/ndk.html"}],["meta",{"property":"og:site_name","content":"Blog"}],["meta",{"property":"og:title","content":"NDK 开发相关"}],["meta",{"property":"og:description","content":"NDK 开发相关 javah使用---native接口头文件生成 javap使用---方法签名获取 使用addr2line定位出错位置 工具位置ndk下/toolchains/arm-linux-androideabi-4.9/prebuilt/darwin-x86_64/bin/中的arm-linux-androideabi-addr2line 使用..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-03-31T13:08:40.000Z"}],["meta",{"property":"article:author","content":"Mr.WenYue"}],["meta",{"property":"article:modified_time","content":"2024-03-31T13:08:40.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"NDK 开发相关\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-03-31T13:08:40.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Mr.WenYue\\",\\"url\\":\\"https://github.com/wswenyue/\\"}]}"]]},"headers":[{"level":3,"title":"javah使用---native接口头文件生成","slug":"javah使用-native接口头文件生成","link":"#javah使用-native接口头文件生成","children":[]},{"level":3,"title":"javap使用---方法签名获取","slug":"javap使用-方法签名获取","link":"#javap使用-方法签名获取","children":[]},{"level":3,"title":"使用addr2line定位出错位置","slug":"使用addr2line定位出错位置","link":"#使用addr2line定位出错位置","children":[]},{"level":3,"title":"使用objdump 显示汇编指令内容。也可通过汇编地址定位相关函数","slug":"使用objdump-显示汇编指令内容。也可通过汇编地址定位相关函数","link":"#使用objdump-显示汇编指令内容。也可通过汇编地址定位相关函数","children":[]},{"level":3,"title":"使用ndk-stack 打印具体信息","slug":"使用ndk-stack-打印具体信息","link":"#使用ndk-stack-打印具体信息","children":[]}],"git":{"createdTime":1711890520000,"updatedTime":1711890520000,"contributors":[{"name":"wswenyue","email":"wswenyue@163.com","commits":1}]},"readingTime":{"minutes":2.93,"words":879},"filePathRelative":"note/ndk.md","localizedDate":"2024年3月31日","excerpt":"\\n<h3>javah使用---native接口头文件生成</h3>\\n<div class=\\"language-bash\\" data-ext=\\"sh\\" data-title=\\"sh\\"><pre class=\\"language-bash\\"><code><span class=\\"token comment\\"># 编译之后，进入到对应class顶层包中,执行javah，会在当前目录下生成对应的头文件。</span>\\n$ javah com.xx.thelight.TheLight\\n<span class=\\"token comment\\"># 如需依赖Android相关环境</span>\\n$ javah <span class=\\"token parameter variable\\">-classpath</span> <span class=\\"token variable\\">$ANDROID_PLATFORMS</span>/android-22/android.jar:. com.xx.thelight.TheLight\\n</code></pre></div>","autoDesc":true}');export{h as comp,g as data};
